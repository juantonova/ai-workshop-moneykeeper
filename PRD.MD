# PRD — Expense Dashboard (Telegram Mini App + Bot) V1

## 1) Vision & Problem Statement
**Проблема:** пользователь не понимает, растут ли чистые накопления и куда уходит больше всего денег.  
**Цель V1:** за 60 секунд ответить:
1) как изменился **Net Worth** за месяц,  
2) **топ‑аномалия** месяца,  
3) как изменились **расходы** за месяц.

## 2) Target Audience & Persona
**Single-user.** Без совместного доступа.

## 3) North Star Metric
**Net Worth (RUB).**

---

## 4) User Stories

### 4.1 Первый день (happy path)
1) Найти бота  
2) Запустить  
3) Автосоздание счёта **“Основная карта” (RUB)**  
4) Ввести opening balance  
5) (Опционально) добавить другие счета  
6) Ввести первый расход  
7) Получить подтверждение и кнопку Mini App  
8) Открыть Mini App и увидеть: быстрые кнопки, балансы, структуру расходов + строку Net Worth (RUB)

### 4.2 Ежемесячный ритуал
За 60 сек увидеть:
1) Δ Net Worth за месяц  
2) Топ‑аномалия месяца  
3) Total expenses за месяц + Δ к прошлому месяцу (RUB и %)  
**Действие:** оценить месяц и скорректировать поведение.

---

## 5) Functional Requirements

### 5.1 Ввод транзакций (Telegram Bot)
**Основной ввод:** Bot  
- **Expense/Income:** `сумма → категория → счёт → подтвердить`  
- **Transfer:** `счёт-источник → счёт-получатель → сумма → подтвердить`  
- **Мультивалюта transfer:** вводятся **две суммы** (source/destination)  
- **Дата/время:** по умолчанию “сейчас”, можно изменить  
- **Скорость ввода:** ≤5 секунд  
- **Обязательные поля расхода:** сумма + категория  
- **Default account:** “Основная карта”  
- **Категория:** поиск по 1–3 буквам

### 5.2 Типы транзакций
- **Expense / Income / Transfer**  
- Transfer **не влияет** на аналитику расходов/доходов

### 5.3 Категории
- Базовый список **12–20** + кастомные  
- У транзакции **1 категория**  
- **Income categories** — отдельный список

### 5.4 Accounts
- Несколько счетов  
- Opening balance обязателен  
- Автосоздание **“Основная карта”**

### 5.5 Net Worth
**Состав:** кэш/карты/депозиты + инвестиции  
**Без:** долгов и крупных активов  
**Расчёт:** “снизу вверх” из транзакций  
**База:** RUB

### 5.6 Investments
- Инвест‑счета как обычные счета  
- Monthly snapshot позиций  
- Позиция: `тикер + стоимость позиции`  
- Между апдейтами: **carry‑forward**  
- История хранится (snapshot)  
- Дата snapshot: “сейчас” (Europe/Moscow)

### 5.7 FX
- Валюты: **RUB, USD, EUR, SOM** (fixed whitelist)  
- Курс берётся **при расчёте net worth**  
- Устарелость ≤24h  
- История **не пересчитывается**  
- Snapshot фиксирует курс на момент

---

## 6) Mini App (Dashboard)

### 6.1 Home (3 блока)
1) Быстрые кнопки “Добавить расход/доход”  
2) Балансы по счетам (в валюте счёта)  
3) Структура расходов за месяц (pie/bar)  
**+ строка “Net Worth (RUB)”**

### 6.2 Аномалии
- Период: **последний завершённый месяц**  
- Норма = среднее за **3 месяца**  
- Аномалия = **+20%**  
- Можно задать коэффициент (persistent)  
- Если <3 месяцев данных — аномалии не показывать

### 6.3 История транзакций
- Редактирование любой транзакции  
- Фильтры: **категория / период / тип**

### 6.4 Edit Last
- Без ограничения по времени  
- Поля: сумма + категория + счёт

---

## 7) Notifications
**Обязательные:**  
A) подтверждение после транзакции + Edit last  
B) weekly digest (понедельник 00:00 MSK)

**Weekly digest:**  
1) Net Worth (RUB) snapshot  
2) Total expenses за неделю  
3) Кнопка “Открыть Mini App”

---

## 8) Snapshots & Time
- Weekly net worth snapshot: **понедельник 00:00 (Europe/Moscow)**  
- При правках старых транзакций: **пересчитываем** все затронутые snapshots

---

## 9) Security & Data
- Логин: **только Telegram user_id**  
- Recovery: одноразовый код 12–16 символов; можно перевыпустить  
- Recovery позволяет привязать новый Telegram user_id  
- Экспорт: **CSV**  
- Hard delete **без бэкапов**  
- Напоминание об экспорте: **раз в месяц**

---

## 10) Non‑Functional Requirements

**Performance (P95):**  
- Bot step response ≤ **1s**  
- Mini App first load ≤ **2s**

**Security:** server‑side (TLS + at‑rest)

---

## 11) Integrations (Backlog)
**IV = интеграции с банковскими API**  
- Данные: выписки за период + балансы  
- Банки (nice‑to‑have): **Райффайзен, Альфа, ВТБ**

---

## 12) Success Metrics
**Успех (90 дней):**  
≥ **80% дней** с записанными тратами

---

# Scope (V1)

**In‑scope**
- Telegram Bot ввод транзакций (Expense/Income/Transfer)
- Mini App как единственная аналитическая поверхность
- Net Worth в RUB (weekly snapshots)
- Мультивалюта с фиксированным whitelist и FX at‑read
- Инвест‑счета с monthly snapshot позиций
- Аномалии по норме 3‑месячного среднего +20%
- CSV экспорт, hard delete, recovery‑код
- Weekly digest и подтверждения транзакций

**Out‑of‑scope**
- E2E‑шифрование  
- Бэкапы  
- Совместный доступ  
- Банковские API (backlog)  
- Бюджеты по категориям  
- Авто‑импорт транзакций  

---

# Risks & Mitigations

**R1: Потеря данных (нет бэкапов)**  
Mitigation: явный UX‑дисклеймер + ежемесячный экспорт‑reminder.

**R2: Низкая дисциплина ввода**  
Mitigation: бот‑ввод ≤5s, минимальные поля, быстрый default account.

**R3: FX и snapshots могут вызывать недоверие**  
Mitigation: фиксируем правило “курс на дату snapshot”, не пересчитываем прошлое.

**R4: Аномалии шумят при малом количестве данных**  
Mitigation: не показывать без 3 полных месяцев.

**R5: Редактирование старых транзакций ломает историю**  
Mitigation: пересчёт всех затронутых snapshots.

---

# Acceptance Criteria (V1)

**Onboarding**
- При первом запуске создаётся “Основная карта (RUB)”  
- Ввод opening balance обязателен  
- Можно добавить расход без настройки категорий

**Bot Input**
- Создание Expense/Income за ≤5 секунд  
- Transfer — отдельный режим, без влияния на аналитику  
- По умолчанию используется “Основная карта”

**Mini App**
- Home содержит 3 блока + строку Net Worth (RUB)  
- Балансы показываются в валюте счёта  
- Есть история транзакций с фильтрами: категория/период/тип  
- Можно редактировать любую транзакцию

**Net Worth**
- Weekly snapshot создаётся понедельник 00:00 MSK  
- FX берётся “при расчёте” и фиксируется  
- История не пересчитывается по новым курсам  
- При редактировании старых транзакций пересчитываются затронутые snapshots

**Аномалии**
- Период по умолчанию: последний завершённый месяц  
- Норма = 3‑месячное среднее +20%  
- При <3 месяцев данных аномалии не показываются  
- Коэффициент нормы на категорию persistent

**Notifications**
- Подтверждение транзакции + Edit last  
- Weekly digest с 3 пунктами: Net Worth, расходы недели, кнопка Mini App

**Data & Security**
- Логин только через Telegram  
- Recovery‑код позволяет перепривязать user_id  
- Экспорт CSV доступен  
- Hard delete удаляет данные полностью (без бэкапов)
