# FND-011 — Review hardening: contracts source, env schema, orchestration decoupling

## Что сделано

- Вынесен source of truth OpenAPI в статический файл:
  - добавлен `api/openapi/openapi.source.json`
  - `api/scripts/generate-openapi.js` упрощен до чтения source и записи `openapi.json`
- Ослаблена связность `contracts` и `api`:
  - `contracts/build` больше не вызывает api-скрипты напрямую
  - orchestration перенесена в root-скрипт `generate:contracts` и workflow публикации
- Унифицирован нейминг скриптов генерации:
  - добавлены `codegen:openapi` и `codegen:client`
  - `generate:*` оставлены как alias для обратной совместимости
- Усилена env-валидация:
  - парсинг через `dotenv.parse`
  - schema-based проверки в `scripts/validate-env.cjs`
  - добавлен единый конфиг портов `configs/ports.json` (base + offsets)
  - добавлены тесты `scripts/validate-env.test.cjs`
- Улучшен healthcheck:
  - baseline режим оставлен по умолчанию
  - добавлен runtime-режим (`pnpm healthcheck:runtime`)
- Добавлен Error DTO в OpenAPI (`ErrorResponseDto`) и ошибки в responses для ключевых операций.
- Задача отмечена выполненной в `BACKLOG.md`.

## Верификация

- `pnpm run generate:contracts`
- `pnpm run validate:env`
- `node --test ./scripts/validate-env.test.cjs`
- `pnpm run healthcheck`
- `pnpm quality`

Ожидаемый результат: contract/codegen/env-check/quality gates проходят, структура source-of-truth и orchestration соответствует принятым решениям.

## ADR

- [ADR-0011: Hardening после review — OpenAPI source, env schema и orchestration](../ADR/ADR-0011-review-hardening-openapi-env-orchestration.md)
